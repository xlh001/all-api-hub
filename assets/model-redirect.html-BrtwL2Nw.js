import{_ as a,c as s,a as r,b as i,e as o,w as n,r as d,o as c,d as t}from"./app-B9UG61OH.js";const u={};function g(m,l){const e=d("RouteLink");return c(),s("div",null,[l[3]||(l[3]=r('<h1 id="模型重定向-model-redirect" tabindex="-1"><a class="header-anchor" href="#模型重定向-model-redirect"><span>模型重定向（Model Redirect）</span></a></h1><blockquote><p>自动为 New API 渠道生成“标准模型 → 实际模型”的映射，让你在下游只需调用统一的模型名称（如 <code>gpt-4o</code>），由系统自动路由到各个上游中转站实际提供的模型。</p></blockquote><h2 id="功能概览" tabindex="-1"><a class="header-anchor" href="#功能概览"><span>功能概览</span></a></h2><ul><li><strong>统一模型调用入口</strong><ul><li>你可以在 New API 中统一使用一组“标准模型名称”（如 <code>gpt-4o</code>、<code>claude-4.5-haiku</code>）。</li><li>模型重定向会将它们映射到各个渠道真实可用的模型名。</li></ul></li><li><strong>自动生成映射</strong><ul><li>基于渠道上报的 <code>models</code> 列表和一组“标准模型清单”，自动计算最合适的对应关系。</li><li>支持按渠道增量合并，保留你手工配置的部分映射。</li></ul></li><li><strong>结合模型同步与渠道管理使用</strong><ul><li>通常与 <strong>New API 模型列表同步</strong> 和 <strong>New API 渠道管理</strong> 搭配使用： <ul><li>模型同步负责把上游可用模型列表拉到 New API。</li><li>模型重定向负责把这些模型对齐到一组“标准模型”。</li></ul></li></ul></li></ul><h2 id="前置条件" tabindex="-1"><a class="header-anchor" href="#前置条件"><span>前置条件</span></a></h2><ul><li>已在插件中配置好 <strong>New API 集成设置</strong>： <ul><li>填写 <strong>管理员 URL</strong>、<strong>Admin Token</strong>、<strong>用户 ID</strong>。</li></ul></li><li>New API 中存在至少一个有效渠道，并且渠道的 <code>models</code> 字段包含可用模型列表。</li><li>已完成一次模型同步（建议），以确保渠道内的模型列表是最新的。</li></ul><h2 id="设置入口" tabindex="-1"><a class="header-anchor" href="#设置入口"><span>设置入口</span></a></h2><ol><li>打开插件 → 进入 <strong>设置</strong> 页面。</li><li>切换到 <strong>“New API”</strong> 标签页。</li><li>在页面下方找到 <strong>“模型重定向”</strong> 区域（<code>id=&quot;model-redirect&quot;</code>）。</li><li>可以看到： <ul><li>启用开关</li><li>标准模型多选列表</li><li>“立即重新生成映射”按钮</li></ul></li></ol><h2 id="主要配置项" tabindex="-1"><a class="header-anchor" href="#主要配置项"><span>主要配置项</span></a></h2><ul><li><strong>启用模型重定向</strong><ul><li>打开后，模型重定向算法会在你手动点击“重新生成”或特定同步流程中被调用。</li></ul></li><li><strong>标准模型列表</strong><ul><li>内置常见厂商的标准模型，例如： <ul><li>OpenAI 系列：<code>gpt-4o</code>、<code>gpt-4o-mini</code>、<code>o3</code>、<code>o3-mini</code> 等。</li><li>Anthropic / Google / Mistral / DeepSeek / 通义千问等主流模型。</li></ul></li><li>你可以按需增删，或手动输入自定义标准模型名。</li></ul></li><li><strong>立即重新生成映射</strong><ul><li>点击按钮后，插件会： <ul><li>拉取所有渠道列表（过滤掉手动/自动禁用的渠道）。</li><li>对每个渠道计算“标准模型 → 实际模型”的映射表。</li><li>将结果与现有 <code>model_mapping</code> 合并后写回（新键覆盖旧值）。</li></ul></li></ul></li><li><strong>清空模型重定向映射（危险操作）</strong><ul><li>点击后会先打开 <strong>预览/选择</strong> 弹窗，加载当前站点下的渠道列表： <ul><li>默认 <strong>全选</strong> 所有渠道；</li><li>支持 <strong>全选 / 全不选</strong> 快捷操作；</li><li>支持逐个勾选需要清空的渠道。</li></ul></li><li>在预览弹窗中点击“继续”后，会出现 <strong>二次确认</strong>（不可误触）： <ul><li>确认后将对所选渠道写入 <code>model_mapping = &quot;{}&quot;</code>（清空映射）。</li><li><strong>未选择的渠道不会被修改</strong>。</li><li>该操作会清空你可能手工维护的自定义映射，且 <strong>不可撤销</strong>。</li></ul></li><li>若出现 <strong>部分失败</strong>： <ul><li>插件会继续尝试清空其余渠道；</li><li>UI 会给出成功/失败摘要，并在弹窗中展示失败明细，便于你重试或手工处理。</li></ul></li></ul></li></ul><h2 id="工作原理-简要" tabindex="-1"><a class="header-anchor" href="#工作原理-简要"><span>工作原理（简要）</span></a></h2><ol><li>读取用户偏好中的模型重定向配置： <ul><li>若未启用，则直接返回并提示“功能已关闭”。</li></ul></li><li>计算标准模型集合： <ul><li>若你未自定义，则使用内置的标准模型全集。</li></ul></li><li>通过 New API 管理接口获取所有渠道列表。</li><li>对每个渠道： <ul><li>解析渠道的 <code>models</code> 字段为实际模型列表。</li><li>对每个标准模型执行多阶段匹配： <ul><li>若渠道本身就包含同名模型，则跳过（无需重定向）。</li><li>否则根据统一的“模型归一化规则”（<code>renameModel</code>）寻找最相近的候选实际模型。</li><li><strong>版本守卫</strong>：只允许匹配同版本模型，不会跨版本降级/升级（例如不会将 <code>claude-4.5-sonnet</code> 映射到 <code>claude-3.5-sonnet</code>；找不到同版本候选则跳过该标准模型）。</li><li>在候选集合中挑选尚未占用的实际模型，写入 <code>standardModel -&gt; actualModel</code> 映射。</li></ul></li><li>将新映射与渠道已有的 <code>model_mapping</code> JSON 合并并写回。</li></ul></li><li>汇总成功更新的渠道数量与失败原因，在 UI 中以 toast 显示。</li></ol><h2 id="典型使用场景" tabindex="-1"><a class="header-anchor" href="#典型使用场景"><span>典型使用场景</span></a></h2><ul><li><strong>统一 OpenAI 兼容模型名</strong><ul><li>不同上游可能用略有差异的模型命名（例如带前缀/后缀）。</li><li>通过模型重定向，可在下游应用中始终使用统一名称，例如 <code>gpt-4o</code>，由 New API 按映射路由到实际模型。</li></ul></li><li><strong>与渠道优先级配合</strong><ul><li>在 New API 中为不同渠道设置权重/优先级，再配合统一的标准模型名，实现多上游容灾和流量分配。</li></ul></li></ul><h2 id="常见问题" tabindex="-1"><a class="header-anchor" href="#常见问题"><span>常见问题</span></a></h2><ul><li><strong>提示 New API 配置缺失</strong><ul><li>请先在 <strong>“基础设置 → New API 集成设置”</strong> 中填写管理员 URL、Token 和用户 ID 并保存。</li></ul></li><li><strong>提示功能未启用</strong><ul><li>确认已在“模型重定向”区域打开“启用模型重定向”开关。</li></ul></li><li><strong>某些标准模型未生成映射</strong><ul><li>说明在对应渠道中未找到可匹配的实际模型，或所有候选都已被其它标准模型占用。</li><li>也可能是该渠道没有<strong>同版本</strong>候选模型：插件不会跨版本降级/升级生成映射。</li><li>可以检查渠道的 <code>models</code> 字段是否完整，或调整标准模型列表。</li></ul></li><li><strong>原有手动配置会被覆盖吗？</strong><ul><li>对于同一个 <code>standardModel</code>，新生成的映射会覆盖旧值；</li><li>其它手工添加但未被覆盖的键仍会保留在 <code>model_mapping</code> 中。</li></ul></li></ul><h2 id="使用建议" tabindex="-1"><a class="header-anchor" href="#使用建议"><span>使用建议</span></a></h2><ul><li>建议先在测试环境或少量渠道上验证生成结果，再在全部渠道上执行批量重定向。</li><li>若你主要通过 <strong>New API 模型同步</strong> 维护模型列表，推荐在完成同步后再点击“重新生成映射”。</li></ul><h2 id="相关文档" tabindex="-1"><a class="header-anchor" href="#相关文档"><span>相关文档</span></a></h2>',19)),i("ul",null,[i("li",null,[o(e,{to:"/new-api-model-sync.html"},{default:n(()=>l[0]||(l[0]=[t("New API 模型列表同步",-1)])),_:1,__:[0]})]),i("li",null,[o(e,{to:"/new-api-channel-management.html"},{default:n(()=>l[1]||(l[1]=[t("New API 渠道管理",-1)])),_:1,__:[1]})]),i("li",null,[o(e,{to:"/quick-export.html"},{default:n(()=>l[2]||(l[2]=[t("快速导出站点配置",-1)])),_:1,__:[2]})])])])}const p=a(u,[["render",g]]),f=JSON.parse('{"path":"/model-redirect.html","title":"模型重定向（Model Redirect）","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1771871466000,"contributors":[{"name":"anime","username":"anime","email":"street-anime-olive@duck.com","commits":1,"url":"https://github.com/anime"},{"name":"qixing-jk","username":"qixing-jk","email":"vq3d5d8c@duck.com","commits":2,"url":"https://github.com/qixing-jk"}],"changelog":[{"hash":"d84e4155953f8718694c2497c7f499cb88ff6397","time":1771871466000,"email":"vq3d5d8c@duck.com","author":"qixing-jk","message":"fix(model-redirect): add version-safety guardrails to mapping generation (#506)"},{"hash":"af028b86cca688dea56277e063ed3b932380029e","time":1771863442000,"email":"vq3d5d8c@duck.com","author":"qixing-jk","message":"feat(model-redirect): add bulk clear functionality for channel mappings (#503)"},{"hash":"c2778fd9b9e8dd5c0f9312313acbecd95a5571d9","time":1764957909000,"email":"street-anime-olive@duck.com","author":"anime","message":"docs: add new sections for CLIProxyAPI integration, model redirect, sorting priority, and permissions management"}]},"filePathRelative":"model-redirect.md"}');export{p as comp,f as data};
