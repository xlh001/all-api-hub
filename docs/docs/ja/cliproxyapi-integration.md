---
title: CLIProxyAPI 連携とワンクリックインポート
description: 中継ステーションアカウントをローカルの CLIProxyAPI 管理インターフェースにワンクリックでインポートし、OpenAI互換プロバイダー設定を自動生成することで、手動での設定ファイルメンテナンスを回避します。
---

# CLIProxyAPI 連携とワンクリックインポート

> 中継ステーションアカウントをローカルの CLIProxyAPI 管理インターフェースにワンクリックでインポートし、OpenAI互換プロバイダー設定を自動生成することで、手動での設定ファイルメンテナンスを回避します。

## 機能概要

- **管理インターフェース連携**
  - CLIProxyAPI の Management API（`/openai-compatibility`）を通じて設定を読み込み、書き戻します。
  - 既存のプロバイダーに API Key を追加/更新するか、新しいプロバイダーを自動作成するのをサポートします。
- **ワンクリックキーインポート**
  - キーリストで「CLIProxyAPI にインポート」をクリックすると、現在のサイトの Base URL とキーを CLIProxyAPI に書き込むことができます。
- **重複設定の回避**
  - サイト名と `Base URL` を自動的に再利用し、同じプロバイダーが検出された場合はキーリストのみを更新し、重複するエントリは作成しません。

## 前提条件

- 互換性のある **CLIProxyAPI** がデプロイまたは実行されており、管理インターフェースが有効になっていること：
  - 例のアドレス：`http://localhost:8317/v0/management`
  - `GET/PUT/PATCH /openai-compatibility` などのインターフェースをサポートします。
- 管理インターフェースの **Management Key** を持っていること（認証用）。
- All API Hub で以下が完了していること：
  - 少なくとも1つの中継ステーションアカウントを追加し、利用可能なキーを取得していること。

## 設定エントリ

1. プラグインを開く → **設定** ページに移動します。
2. **「CLIProxyAPI」** グループに切り替えます（`基本設定 → CLIProxyAPI` タブ）。
3. 以下のフィールドを入力します：
   - **管理インターフェース基本 URL**：例 `http://localhost:8317/v0/management`
   - **管理キー（Management Key）**：管理インターフェースにアクセスするためのキー。
4. 保存後、設定はローカルのプリファレンスに保存され、以降のインポート操作で再利用されます。

## キーリストからのワンクリックインポート

1. プラグインを開く → **キー管理** ページに移動します。
2. CLIProxyAPI にインポートしたいサイトキーカードを見つけます。
3. キーの右側にある CLIProxyAPI アイコンボタンをクリックします（通常、CherryStudio / CC Switch / New API ボタンの隣）。
4. プラグインは以下を行います：
   - CLIProxyAPI の設定（基本 URL と管理キー）を読み込みます。
   - サイトの `Base URL` を使用して OpenAI 互換アドレスを生成します（`/v1` を自動的に付加）。
   - サイト名または Base URL をプロバイダー名として使用します。
   - CLIProxyAPI を呼び出します：
     - 同名または同じ `base-url` のプロバイダーが既に存在する場合：
       - 重複を排除した後、`api-key-entries` に現在のキーを追加します。
     - 存在しない場合：
       - 現在のキーと基本情報のみを含む新しいプロバイダーエントリを作成します。
5. 操作完了後、右上にインポート結果の通知（成功/失敗とエラー原因）が表示されます。

## CLIProxyAPI へのインポート後の効果

- CLIProxyAPI の設定では、以下のような構造が新規追加または更新されます：
  - `name`：サイト名（または Base URL）に由来します。
  - `base-url`：対応する中継ステーションの `/v1` OpenAI 互換インターフェースを統一的に指します。
  - `api-key-entries`：1つまたは複数の `api-key` レコードを含み、CLIProxyAPI 内で手動で編集を続けることができます。
- これは以下のことを意味します：
  - CLIProxyAPI レイヤーで複数のアップストリーム中継ステーションのキーを一元管理できます。
  - All API Hub は基本設定情報を同期する役割を担い、その後の詳細は CLIProxyAPI 内でカスタマイズできます。

## よくある質問

- **CLIProxyAPI が設定されていません**
  - **設定 → CLIProxyAPI** で基本 URL と管理キーが入力されているか確認してください。
  - `/openai-compatibility` が余分に含まれていないことを確認してください。管理インターフェースのプレフィックスであるべきです。例：`.../v0/management`。
- **401/403 またはその他の HTTP エラーが返される**
  - 管理キーが正しいこと、および現在のユーザーが管理インターフェースにアクセスする権限を持っていることを確認してください。
  - CLIProxyAPI のバックエンドログを確認し、ルーティングとメソッド（GET/PUT/PATCH）が有効になっているか確認してください。
- **重複してインポートすると、多くのレコードが生成されますか？**
  - いいえ。プラグインは `base-url` または名前に基づいて既存のプロバイダーを検索します：
    - 存在する場合は、`api-key-entries` のみを更新し、同じキーの重複を排除します。
    - 存在しない場合にのみ、新しいプロバイダーを作成します。

## 使用のヒント

- 少数のテストアカウントでインポート効果を検証してから、本番環境で使用することをお勧めします。
- All API Hub の **クイックエクスポート** 機能と連携して、同じアップストリームサイトのバッチを New API / CLIProxyAPI など複数のダウンストリームシステムに同期できます。

## 関連ドキュメント

- [サイト設定のクイックエクスポート](./quick-export.md)
- [New API チャネル管理](./new-api-channel-management.md)
- [New API モデルリスト同期](./new-api-model-sync.md)