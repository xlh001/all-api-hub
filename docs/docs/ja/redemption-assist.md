# 引き換えアシスタント（Redemption Assist）

> 引き換えコードをワンクリックで識別し、ワンクリックで引き換え、繰り返しコピー＆ペーストする手間を省きます。

## 機能概要

- **引き換えコードの自動識別**：ウェブページ上でテキストをクリック、選択、またはコピーすると、拡張機能がそこから引き換えコードを識別しようと試み、手動で一文字ずつ確認する必要がなくなります。
- **便利なポップアップ通知**：引き換えコードの可能性があるものを検出すると、右下隅に小さな通知カードがポップアップ表示され、すぐに引き換えるかどうかを尋ねます。
- **アカウントのスマートマッチング**：現在のページアドレスに基づいて、All API Hub から最も一致するサイトアカウントを自動的に検索し、自分でリストを探す手間を省きます。
- **ワンクリックで引き換え完了**：「自動引き換え」をクリックすると、拡張機能がバックグラウンドでリクエストを送信し、通知バブルの形式で引き換え結果を表示します。
- **独立したオン/オフスイッチ**：設定で引き換えアシスタントを個別に有効/無効にでき、他の機能モジュールには影響しません。

## 使用前提

1.  **All API Hub に対応するサイトアカウントが既に存在すること**：
    -   少なくとも1つのアカウントが正常に利用でき、残高、権限に異常がないこと。
2.  **ページ上に実際に引き換えコードが存在すること**：
    -   一般的な形式には「今日の引き換えコード」「ギフトコード」「チェックインコード」などがあり、通常は32桁の文字列の組み合わせです。

---

## 使用チュートリアル

### チュートリアル1：引き換えアシスタントをゼロから設定する

1.  **少なくとも1つのターゲットサイトアカウントを追加する**
    -   アカウント管理で引き換えコードを使用したいサイトアカウントを追加し、正常にログインおよびアクセスできることを確認します。

2.  **引き換えアシスタントのスイッチをオンにする（デフォルトでオン）**
    -   「基本設定」ページで「引き換えアシスタント」をオンにし、他のデフォルト設定のままで正常に利用できます。

3.  **アカウントにカスタムチェックイン/引き換えアドレスを追加する（推奨）**
    -   アカウント編集ページを開き、「カスタムチェックイン/引き換えアドレス」を見つけます。
    -   普段直接アクセスする引き換えページのアドレスを入力すると、システムが現在のページとアカウントをより正確にマッチングしやすくなります。

上記の手順を完了すると、グローバル引き換え補助機能を体験できます。

### チュートリアル2：日常使用における典型的な引き換えプロセス

1.  **引き換えコードを含むページを開く**
    -   例：イベント告知ページ、チェックイン報酬ページ、チャンネルメッセージなど。
    -   ページ上には通常、32桁の文字列が引き換えコードとして表示されます。

2.  **検出アクションをトリガーする**
    -   引き換えコードに対して以下のいずれかの操作を実行します。
        -   マウスでドラッグして引き換えコードを選択する。
        -   ショートカットキーを使用して引き換えコードをコピーする。
        -   一部のページでコピー可能な領域をクリックする。

3.  **右下隅の引き換えアシスタントの通知を確認する**
    -   システムが引き換えコードの可能性があるものを識別すると、右下隅に通知カードがポップアップ表示され、匿名化された引き換えコードのプレビューが表示されます。

4.  **確認して自動引き換えを開始する**
    -   カード内の「自動引き換え」をクリックします。
    -   拡張機能は現在のページURLに基づいて、最も適切なアカウントを自動的に選択し、引き換えリクエストを送信します。

5.  **結果の通知を確認する**
    -   成功時：
        -   通常、「引き換え成功」および入金されたクォータなどの情報が表示されます。
    -   失敗時：
        -   失敗原因（例：引き換えコードが無効、引き換えコードは既に使用済みなど）または一般的な失敗通知が表示されます。

### チュートリアル3：複数アカウントのシナリオで適切なアカウントを選択する方法

1.  **同じサイトに複数の利用可能なアカウントがある場合**
    -   引き換えアシスタントは、任意のアカウントを直接使用するのではなく、「アカウント選択」ポップアップを表示します。

2.  **ポップアップでアカウント情報を確認する**
    -   アカウント名、サイトアドレス、メモなどの主要な情報を確認できます。
    -   アカウントが多い場合は、検索フィルターを利用してターゲットアカウントを素早く見つけることができます。

3.  **アカウントを選択して引き換えを確定する**
    -   最も適切なアカウントを選択した後、確認をクリックすると、システムは選択されたアカウントに対して実際の引き換え操作を実行します。

---

### ワンクリック引き換えの成功率を向上させる方法

「自動引き換えを一度クリックするだけで完了させたい」場合は、以下の2点を重点的に最適化できます。

-   **よく使うアカウントにカスタムチェックイン/引き換えアドレスを設定する**：
    -   アカウント編集ページで、「カスタムチェックイン/引き換えアドレス」を見つけ、実際に引き換えに使用するページアドレスを入力します。
    -   これにより、システムがURLに基づいてアカウントをマッチングする際に、より正確になり、複数アカウントの曖昧さを減らすことができます。

上記の条件を満たせば、ほとんどの場合、「自動引き換え」をクリックするだけで直接成功し、手動でアカウントを選択する必要はほとんどなくなります。

---

## よくある質問

### Q1：ページ上に引き換えコードがあるのに、通知がポップアップ表示されません？

考えられる原因：

-   設定で「引き換えアシスタント」が有効になっていません。
-   引き換えコードに対して選択またはコピーなどの操作を実行していないため、拡張機能がテキストを読み取る機会がありません。
-   引き換えコードが標準の32桁の文字列ではない、または途中にスペースや特殊記号が含まれているため識別できません。
-   ブラウザまたは他の拡張機能がスクリプトの実行やクリップボードへのアクセスを制限しています（例：極端なシークレットモード、一部のセキュリティ拡張機能によるブロック）。

推奨されるトラブルシューティング手順：

1.  All API Hub の設定で「引き換えアシスタント」がオンになっていることを確認します。
2.  アカウント管理で現在のサイトアカウントが追加されており、正常にアクセスできることを確認します。
3.  常用デスクトップブラウザ（Chrome / Edge / Firefox）で再試行します。
4.  それでも解決しない場合は、リポジトリのIssuesにサイトのスクリーンショットとデバッグ情報を添えてフィードバックしてください。

### Q2：自動引き換えはアカウントのセキュリティに影響しますか？

-   引き換えアシスタントのロジックはローカルブラウザ内でのみ実行され、アカウント情報や引き換えコードが第三者のサーバーにアップロードされることはありません。
-   すべてのAPIリクエストは、対応するアグリゲートサイトに直接送信されます。
-   ブラウザ自身のパスワードとプライバシー保護ポリシー（例：ブラウザのパスワード管理、プライベートモードなど）と組み合わせて使用することをお勧めします。

## 関連ドキュメント

-   [自動チェックインとチェックイン監視](./auto-checkin.md)