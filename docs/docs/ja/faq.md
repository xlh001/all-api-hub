# よくある質問

プラグインの使用中に遭遇する可能性のある一般的な問題をまとめました。

## 🔐 認証方式について

### CookieモードとAccess Token方式の違いは何ですか？

プラグインは2つの認証方式をサポートしています：

| 認証方式 | 特徴 | 適用シナリオ | 推奨度 |
|---------|------|---------|---------|
| **Access Token** | ✅ 複数アカウント対応<br>✅ 永続的で期限切れなし<br>✅ より安全で安定 | ほとんどの標準的な中継サイト | ⭐⭐⭐⭐⭐ 強く推奨 |
| **Cookie** | ⚠️ シングルアカウント<br>⚠️ 期限切れの可能性あり<br>✅ 互換性が高い | トークンが制限されている特殊なサイト<br>カスタム改変サイト | ⭐⭐⭐ 特殊な状況での使用 |

**Access Token方式の使用を推奨します**。ただし、以下の状況に遭遇した場合を除きます：
- サイトがアクセストークンをサポートしていない
- カスタム改変版の中継サイトを使用している
- Token 機能が無効になっている

### 認証方式を切り替えるには？

アカウントを追加する際、アカウントダイアログで対応する認証方式を選択します：
1. 「新規アカウント追加」をクリック
2. サイトアドレスを入力
3. 「認証方式」ドロップダウンリストから `Access Token` または `Cookie` を選択
4. 「自動認識」をクリック

## 🔧 特殊なサイトに関する問題

<a id="anyrouter-error"></a>
### AnyRouterサイトでエラーが発生した場合、どうすればよいですか？

AnyRouterはカスタム改変版の中継サイトであり、標準のAccess Token方式をサポートしていません。

**解決策**：
1. アカウントを追加する際、**Cookieモード**を選択します。
2. まずブラウザでAnyRouterサイトにログインします。
3. その後、プラグインの自動認識機能を使用してアカウントを追加します。

::: warning 注意
AnyRouterはAPIを変更しているため、一部の機能が正常に動作しない可能性があります。問題が発生した場合は、サイト管理者に連絡することをお勧めします。
:::

### Sub2API（JWTサイト）はどのように追加しますか？

Sub2APIサイト（一般的な特徴：コンソールインターフェースが `/api/v1/*` にあり、JWTログイン状態を使用）は、サイトコンソールのlocalStorageからログイン情報（`auth_token` / `auth_user`）を読み取る必要があるため、残高の自動認識と更新を行うには**まずブラウザでサイトコンソールにログインする必要があります**。

**追加手順**：
1. ブラウザで対象サイトのコンソールを開き、ログインします（ログインページにリダイレクトされていないことを確認してください）。
2. プラグインを開く → 新規アカウント追加。
3. サイトURLを入力し、「自動認識」をクリックします。

**既知の制限**：
- **アクセストークン（JWT）** モードのみをサポートし、Cookie認証はサポートしていません。
- サイトのチェックイン機能は現在サポートされていません（チェックイン検出は自動的にオフになります）。
- 現在のバージョンでは主に**残高/クォータ**を同期します。「今日の使用量/収益」などの統計は0になる可能性があります。
- 更新時に401エラーが発生した場合、プラグインは `auth_token` を再読み込みして再試行します。それでも失敗する場合は、サイトコンソールに再度ログインしてから更新/再認識を行ってください。

### 自動認識が失敗した場合、どうすればよいですか？

自動認識が失敗した場合は、以下の方法を試してください：

1.  **認証方式の切り替え**：Access TokenからCookieモードへの切り替えを試してください。
2.  **手動追加**：自動認識が失敗した後、以下の情報を手動で入力してください：
    -   ユーザー名
    -   ユーザーID
    -   アクセストークン
    -   チャージレート
3.  **ログイン状態の確認**：ブラウザで対象サイトにログインしていることを確認してください。
4.  **サイトの互換性の確認**：サイトがサポートされているプロジェクト（下記参照）に基づいていることを確認してください。

### どのサイトが互換性がない可能性がありますか？

サイトが大幅な二次開発を行い、重要なインターフェース（例：`/api/user`）を変更した場合、プラグインが正常に動作しない可能性があります。

一般的な非互換性の状況：
- ユーザー情報インターフェースが変更されている
- アクセストークン機能が無効になっている
- 認証方式がカスタマイズされている
- API応答形式が変更されている

## 🐛 機能とバグについて

### 機能の問題やバグに遭遇した場合、どうすればよいですか？

1.  **Issueの検索**：[GitHub Issues](https://github.com/qixing-jk/all-api-hub/issues) にアクセスし、同様の問題がないか検索してください。
2.  **最新バージョンの使用**：
    -   ストア版の更新は遅いため、GitHub Release版の使用を推奨します。
    -   または、mainブランチの開発バージョンを直接使用してください。

### 最新バージョンを入手するには？

プラグインは複数のプラットフォームで公開されており、更新速度に違いがあります：

| プラットフォーム | 更新速度 | バージョン入手 |
|------|---------------|---------|
| **GitHub Releases** | ⚡ 最速 | [ダウンロードはこちら](https://github.com/qixing-jk/all-api-hub/releases) |
| **Chrome Web Store** | 🐌 遅い（3-5日間の審査） | [インストールはこちら](https://chromewebstore.google.com/detail/lapnciffpekdengooeolaienkeoilfeo) |
| **Edge Add-ons** | 🐌 遅い（3-5日間の審査） | [インストールはこちら](https://microsoftedge.microsoft.com/addons/detail/pcokpjaffghgipcgjhapgdpeddlhblaa) |
| **Firefox Add-ons** | ⚡ 速い（数時間の審査） | [インストールはこちら](https://addons.mozilla.org/firefox/addon/{bc73541a-133d-4b50-b261-36ea20df0d24}) |

::: tip ヒント
修正済みのバグに遭遇した場合は、GitHub Releasesから最新バージョンをダウンロードして手動でインストールすることをお勧めします。
:::

## ⚙️ 機能の使用に関する問題

### WebDAVバックアップを使用するには？

WebDAVバックアップは、複数のデバイス間でデータを同期するのに役立ちます：

1.  **WebDAVの設定**：
    -   「設定」→「WebDAVバックアップ」を開く
    -   WebDAVサーバーアドレス（完全なURL）を入力
    -   ユーザー名とパスワードを入力
    
2.  **同期ポリシーの選択**：
    -   `マージ`（推奨）：ローカルデータとリモートデータをインテリジェントにマージ
    -   `アップロードのみ`：ローカルデータのみをサーバーにアップロード
    -   `ダウンロードのみ`：サーバーからデータのみをダウンロード

3.  **自動同期の有効化**：
    -   「自動同期を有効にする」にチェックを入れる
    -   同期間隔を設定（デフォルト3600秒/1時間）

::: tip 推奨サービス
- [堅果雲](https://www.jianguoyun.com/)（中国国内からのアクセスが速い）
- Nextcloud（セルフホスト）
- Synology NAS（Synology）
:::

### CherryStudio / New APIにエクスポートするには？

高速エクスポート機能により、サイト設定をワンクリックで他のプラットフォームにインポートできます：

**設定手順**：

1.  **New APIの場合**：
    -   「設定」→「基本設定」を開く
    -   New APIサーバーアドレスを設定
    -   管理者トークン（Admin Token）を入力
    -   ユーザーIDを入力

2.  **CherryStudioの場合**：
    -   追加設定は不要
    -   CherryStudioが実行中であることを確認

**エクスポート手順**：

1.  「キー管理」ページに移動
2.  エクスポートしたいサイトを見つける
3.  操作メニューをクリック
4.  「CherryStudioにエクスポート」または「New APIにエクスポート」を選択

::: info スマート検出
New APIにエクスポートする際、プラグインは同じチャネルが既に存在するかどうかを自動的に検出し、重複追加を回避します。
:::

より完全なエクスポートと統合の説明については、[サイト設定の高速エクスポート](./quick-export.md) を参照してください。CLIProxyAPI管理インターフェースとの連携を希望する場合は、[CLIProxyAPI統合](./cliproxyapi-integration.md) を参照してください。

### サイトのチェックイン機能を使用するには？

一部の中継サイトでは、毎日のチェックインで報酬を獲得できます：

1.  **チェックイン検出の有効化**：
    -   アカウントを編集
    -   「チェックイン検出を有効にする」にチェックを入れる
    
2.  **カスタムチェックインURL**（オプション）：
    -   サイトのチェックインページが標準パスではない場合
    -   「カスタムチェックインURL」を入力できます
    -   「カスタムチャージURL」（オプション）を入力

3.  **チェックインの実行**：
    -   チェックインが必要なアカウントにはチェックインアイコンが表示されます
    -   アカウントカード上のチェックインボタンをクリック
    -   チェックインページが自動的に開きます

### アカウントの並べ替えをカスタマイズするには？

プラグインは、複数の並べ替え方法の優先順位設定をサポートしています：

1.  **並べ替え設定へのアクセス**：
    -   「設定」→「並べ替え優先順位設定」を開く
    
2.  **優先順位の調整**：
    -   並べ替え条件をドラッグして優先順位を調整
    -   条件の有効化/無効化をチェック/チェック解除
    
3.  **利用可能な並べ替え条件**：
    -   📌 現在のサイトをトップに固定
    -   🏥 ヘルスステータスによる並べ替え（エラー > 警告 > 不明 > 正常）
    -   ✅ チェックインが必要なアカウントをトップに固定
    -   🔗 カスタムチェックインURLを持つアカウントをトップに固定
    -   📊 ユーザー定義フィールドによる並べ替え（残高/消費/収益/名前）

各並べ替えルールの詳細な意味と設定例については、[並べ替え優先順位設定](./sorting-priority.md) を参照してください。

### 自動更新はどのように設定しますか？

自動更新により、アカウントデータを最新の状態に保つことができます：

1.  **自動更新の有効化**：
    -   「設定」→「自動更新」を開く
    -   「定期的な自動更新を有効にする」にチェックを入れる
    
2.  **更新間隔の設定**：
    -   デフォルト：360秒（6分）
    -   最小：60秒（1分）
    -   サイト数に応じて調整
    
3.  **その他のオプション**：
    -   ✅ プラグインを開くときに自動更新
    -   ✅ ヘルスステータスを表示

::: warning 注意
更新間隔が短すぎると頻繁なリクエストが発生する可能性があるため、60秒以上に設定することをお勧めします。
:::

## 📱 モバイルでの使用

### スマートフォンで使用するには？

プラグインはモバイルデバイスでの使用をサポートしています：

**Androidデバイス**：
1.  [Kiwi Browser](https://play.google.com/store/apps/details?id=com.kiwibrowser.browser) をインストール（推奨）
    -   Chrome拡張機能と完全に互換性あり
    -   すべての機能をサポート
    
2.  または Firefox for Android をインストール
    -   Firefox Add-onsからインストール

**iOSデバイス**：
- 現在はサポートされていません（iOSの制限）

### モバイルでの使用に関する推奨事項

1.  **サイドバーモードを使用**：スマートフォンの画面により適しています
2.  **自動更新を有効にする**：頻繁な手動更新を避けるため
3.  **WebDAV同期を設定**：PCとスマートフォンの間でデータを同期するため

## 🔒 データセキュリティ

### データはどこに保存されますか？

-   **ローカルストレージ**：すべてのデータはブラウザのローカルストレージに保存されます
-   **完全オフライン**：プラグインのコア機能はインターネット接続を必要としません
-   **データはアップロードされません**：いかなる第三者サーバーにもデータはアップロードされません

### データは失われますか？

定期的なデータバックアップをお勧めします：

1.  **JSONエクスポート**：
    -   「設定」→「データとバックアップ」に移動
    -   「データのエクスポート」をクリック
    -   JSONファイルを保存

2.  **WebDAV同期**（推奨）：
    -   自動的にクラウドにバックアップ
    -   複数デバイスでの同期をサポート

## 🆘 その他の問題

### サイトの重複検出とは何ですか？

サイトを追加する際、プラグインは同じサイトが既に存在するかどうかを自動的に検出します：
-   サイトURLに基づいて判断
-   既に存在する場合は、プロンプトが表示され、迅速な変更が可能です
-   同じサイトの重複追加を回避

### ヘルスステータスとはどういう意味ですか？

ヘルスステータスはアカウントの可用性を示します：

| ステータス | アイコン | 意味 |
|------|------|------|
| 🟢 正常 | Healthy | アカウントは正常に動作しています |
| 🟡 警告 | Warning | 残高不足または注意が必要 |
| 🔴 エラー | Error | API呼び出しの失敗またはアカウントの異常 |
| ⚪ 不明 | Unknown | 未検出またはステータスを取得できません |

### プラグインはデータ通信量を消費しますか？

-   アカウントデータを更新する際にのみサイトAPIにアクセスします
-   リクエスト量は非常に少ないです（各サイト約数KB）
-   WiFi環境での自動更新の使用を推奨します

### コードを貢献するには？

プルリクエストの提出を歓迎します：
1.  プロジェクトリポジトリをフォーク
2.  機能ブランチを作成
3.  コードをコミット
4.  プルリクエストを送信

詳細はこちら：[CONTRIBUTING.md](https://github.com/qixing-jk/all-api-hub/blob/main/CONTRIBUTING.md)

---

## 📚 関連ドキュメント

- [使用方法](./get-started.md)
- [GitHubリポジトリ](https://github.com/qixing-jk/all-api-hub)
- [問題報告](https://github.com/qixing-jk/all-api-hub/issues)
- [更新履歴](./changelog.md)

::: tip 答えが見つかりませんか？
上記の内容で問題が解決しない場合は、[GitHub Issues](https://github.com/qixing-jk/all-api-hub/issues) で質問してください。
:::