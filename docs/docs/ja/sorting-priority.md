# ソート優先順位設定

> アカウントリストにおける各種ソートルールの優先順位をカスタマイズし、最も重要で注目すべきアカウントを常に上位に表示させます。

## 機能概要

- **複数のソートルールを組み合わせ**
  - 無効状態、ピン留め状態、現在のサイト、ヘルスステータス、チェックイン要件、カスタムリンク、ユーザーフィールドなど、多次元でのソートをサポートします。
- **ドラッグ＆ドロップで優先順位を調整**
  - 設定ページでドラッグ＆ドロップするだけで、各ソートルールの順序を変更できます。
- **必要に応じて有効化/無効化**
  - 各ソートルールは個別にオン/オフを切り替えることができ、異なる使用習慣に適応します。

## 設定へのアクセス

1. プラグインを開く → **設定** ページに移動します。
2. **「アカウント管理」** タブに切り替えます。
3. ページ下部の **「ソート優先順位設定」** 領域を見つけます。

> ヒント：利用ドキュメントでも「設定 → ソート優先順位設定」へのアクセス方法が記載されていますが、このページではその機能の詳細を説明しています。

## 利用可能なソートルールについて

以下の表はコード内の `SortingCriteriaType` に対応しており、UIではより分かりやすい日本語の表記で表示されます。

- **無効なアカウントを最下部に（disabledAccount）**
  - 説明：無効化されたアカウントは常にリストの最下部に配置され、日常的な使用の邪魔になりません。

- **ピン留め優先（pinnedPriority）**
  - 説明：ピン留めされたすべてのアカウントはリストの最上位に優先的に配置され、ピン留めされた順序で並べられます。
  - よく使うサイトや重要なサイトを上部に配置するのに適しています。

- **現在のサイト優先（currentSitePriority）**
  - 説明：特定の中継サイトページでプラグインを開いた際、そのサイトに対応するアカウントが上位に表示されます。
  - サイトを閲覧しながら、対応するアカウント情報を確認するのに便利です。

- **ヘルスステータス（healthStatus）**
  - 説明：「エラー > 警告 > 不明 > 正常」の順序でソートされ、異常なアカウントがより上位に表示されます。
  - 異常なチャネルを素早く発見するために、常に有効にすることをお勧めします。

- **チェックイン要件（checkInRequirement）**
  - 説明：チェックインが必要なアカウントが上位に、チェックイン済みまたは不要なアカウントが下位に配置されます。
  - 自動チェックイン機能と組み合わせることで、未チェックインのアカウントを優先的に処理できます。

- **手動ソート（manualOrder）**
  - 説明：アカウントリストで手動で調整した順序を尊重します。
  - 有効にすると、リスト内のアカウントのドラッグによる順序変更が記憶され、ソートに利用されます。

- **ユーザーカスタムフィールドソート（userCustomSort）**
  - 説明：アカウントリストで選択したフィールド（残高、消費、収入など）に基づいてソートします。
  - 例えば、残高が最も低いアカウントを上位に配置し、タイムリーなチャージを促すことができます。

- **カスタムチェックインURL優先（customCheckInUrl）**
  - 説明：カスタムチェックインURLを使用しているアカウントが優先的に表示されます。
  - 多数のサイトの中で、一部が特殊なチェックインアドレスを使用しているシナリオに適しています。

- **カスタム引き換えURL優先（customRedeemUrl）**
  - 説明：カスタム引き換えURLを使用しているアカウントが優先的に表示されます。
  - 特殊なチャージ/引き換え入口を持つサイトを素早く見つけるのに便利です。

- **開いているタブとの一致（matchedOpenTabs）**
  - 説明：ブラウザで現在開いているタブに特定のサイトのページが含まれている場合、そのサイトに対応するアカウントが上位に表示されます。
  - 「閲覧しながら調査/設定調整」のワークフローに適しています。

## 優先順位の調整方法

1. **「ソート優先順位設定」** パネルで、ソートルールカードのリストを確認します。
2. ルールにマウスカーソルを合わせ、ドラッグハンドルを押しながら上下にドラッグします。
   - 上に位置するほど優先順位が高くなります。
3. 調整後、すぐにローカル設定に保存され、アカウントリストのソートロジックに適用されます。

## 特定のルールを有効または無効にする

1. 特定のルールカードにあるトグルボタン（通常はカードの右側）を見つけます。
2. スイッチをオフにすると、そのルールはソート時に無視されます。オンにすると、ソート計算に含まれます。
3. オフ/オンの切り替え後も、すぐに保存され、アカウントリストの表示順序が更新されます。

## ソート例

- **例1：異常に注目 + 現在のサイト**
  - ルール順序：ヘルスステータス → 現在のサイト → ピン留め優先。
  - 効果：
    - 異常なアカウントは常に上位に表示されます。
    - 異常なアカウントの中で、現在のサイトが優先的に表示されます。
    - 残りはピン留めの有無やその他のルールに従ってソートされます。

- **例2：チェックイン優先**
  - ルール順序：チェックイン要件 → ピン留め優先 → ヘルスステータス。
  - 効果：
    - チェックインが必要なアカウントは、ヘルスステータスに関わらず最上位に表示され、毎日のチェックインを一気に完了するのに便利です。

- **例3：残高駆動**
  - ルール順序：ユーザーカスタムフィールドソート（残高） → ヘルスステータス。
  - 効果：
    - 残高が最も低いアカウントが上位に表示され、間もなく使い切るクォータをタイムリーに発見できます。
    - 同時にヘルスステータスと組み合わせることで、異常なアカウントが引き続き目立つように表示されます。

## よくある質問

- **ソート結果が期待と異なる場合**
  - 高優先順位のルールが無視されていないか（スイッチがオフになっていないか）、またはソート順序が期待通りでないかを確認してください。
  - それでも疑問がある場合は、GitHub Issues にスクリーンショットを添付し、具体的なソート結果と期待するロジックをフィードバックしてください。

## 関連ドキュメント

- [自動チェックインとチェックイン監視](./auto-checkin.md)
- [自動更新とリアルタイムデータ](./auto-refresh.md)