# 並べ替え優先順位設定

> アカウントリストにおける様々な並べ替えルールの優先順位をカスタマイズし、最も重要で注目すべきアカウントが常に上位に表示されるようにします。

## 機能概要

- **複数の並べ替えルールを組み合わせ**
  - ピン留め状態、現在のサイト、ヘルスステータス、チェックイン要件、カスタムリンク、ユーザーフィールドなど、多次元での並べ替えをサポートします。
- **ドラッグ＆ドロップで優先順位を調整**
  - 設定ページでドラッグ＆ドロップするだけで、各並べ替えルールの順序を変更できます。
- **必要に応じて有効/無効化**
  - 各並べ替えルールは個別にオン/オフでき、様々な使用習慣に対応します。

## 設定へのアクセス

1. プラグインを開き → **設定** ページに移動します。
2. **「アカウント管理」** タブに切り替えます。
3. ページ下部の **「並べ替え優先順位設定」** 領域を見つけます。

> ヒント：利用ドキュメントでも「設定 → 並べ替え優先順位設定」へのアクセス説明を見ることができますが、このページではその機能の詳細を説明しています。

## 利用可能な並べ替えルールの説明

以下の表はコード内の `SortingCriteriaType` に対応しており、UIではより分かりやすい日本語の表記で表示されます：

- **ピン留め優先（pinnedPriority）**
  - 説明：ピン留めされたすべてのアカウントは、リストの最上位に優先的に表示され、ピン留めされた順序で並べ替えられます。
  - よく使うサイトや重要なサイトをトップに表示するのに適しています。

- **現在のサイト優先（currentSitePriority）**
  - 説明：特定の中継サイトページでプラグインを開いた際、そのサイトに対応するアカウントが上位に表示されます。
  - サイトを閲覧しながら、対応するアカウント情報を確認するのに便利です。

- **ヘルスステータス（healthStatus）**
  - 説明：「エラー > 警告 > 不明 > 正常」の順序で並べ替えられ、異常なアカウントがより上位に表示されます。
  - 異常なチャネルを素早く発見するために、常に有効にしておくことを推奨します。

- **チェックイン要件（checkInRequirement）**
  - 説明：チェックインが必要なアカウントが上位に表示され、チェックイン済みまたはチェックイン不要なアカウントは下位に表示されます。
  - 自動チェックイン機能と組み合わせることで、未チェックインのアカウントを優先的に処理できます。

- **手動並べ替え（manualOrder）**
  - 説明：アカウントリストで手動で調整した順序が尊重されます。
  - 有効にすると、リスト内でアカウントをドラッグして並べ替えた順序が記憶され、並べ替えに利用されます。

- **ユーザーカスタムフィールド並べ替え（userCustomSort）**
  - 説明：アカウントリストで選択したフィールド（残高、消費など）に基づいて並べ替えを行います。
  - 例えば、残高が最も低いアカウントを上位に表示し、タイムリーなチャージを促すことができます。

- **カスタムチェックインURL優先（customCheckInUrl）**
  - 説明：カスタムチェックインURLを使用しているアカウントが優先的に表示されます。
  - 多数のサイトの中で、一部が特殊なチェックインアドレスを使用しているシナリオに適しています。

- **カスタム引き換えURL優先（customRedeemUrl）**
  - 説明：カスタム引き換えURLを使用しているアカウントが優先的に表示されます。
  - 特殊なチャージ/引き換え入口を持つサイトを素早く見つけるのに便利です。

- **開いているタブとの一致優先（matchedOpenTabs）**
  - 説明：ブラウザで現在開いているタブに特定のサイトのページが含まれている場合、そのサイトに対応するアカウントが上位に表示されます。
  - 「閲覧しながら調査/設定調整」といったワークフローに適しています。

## 優先順位の調整方法

1. **「並べ替え優先順位設定」** パネルで、並べ替えルールカードのリストを確認します。
2. ルールにマウスカーソルを合わせ、ドラッグハンドルを掴んで上下にドラッグします：
   - 上にあるほど優先順位が高くなります。
3. 調整後、すぐにローカル設定に保存され、アカウントリストの並べ替えロジックに適用されます。

## ルールの有効化または無効化

1. 各ルールカードにあるスイッチボタン（通常はカードの右側にあります）を見つけます。
2. スイッチをオフにすると、そのルールは並べ替え時に無視されます。オンにすると、並べ替え計算に含まれます。
3. オフ/オン後も、すぐに保存され、アカウントリストの表示順序が更新されます。

## 並べ替えの例

- **例1：異常に注目 + 現在のサイト**
  - ルール順序：ヘルスステータス → 現在のサイト → ピン留め優先。
  - 効果：
    - 異常なアカウントは常に上位に表示されます。
    - 異常なアカウントの中で、現在のサイトが優先的に表示されます。
    - 残りはピン留めの有無や他のルールに従って並べ替えられます。

- **例2：チェックイン優先**
  - ルール順序：チェックイン要件 → ピン留め優先 → ヘルスステータス。
  - 効果：
    - チェックインが必要なアカウントは、ヘルスステータスに関わらず最上位に表示され、毎日のチェックインを一気に完了するのに便利です。

- **例3：残高駆動**
  - ルール順序：ユーザーカスタムフィールド並べ替え（残高） → ヘルスステータス。
  - 効果：
    - 残高が最も低いアカウントが上位に表示され、使い切る寸前のクォータをタイムリーに発見できます。
    - 同時にヘルスステータスと組み合わせることで、異常なアカウントが引き続き目立つように表示されます。

## よくある質問

- **並べ替え結果が期待と異なる場合**
  - 優先順位の高いルールが無視されている（スイッチがオフになっている）か、並べ替え順序が期待通りでないかを確認してください。
  - それでも疑問がある場合は、GitHub Issues で具体的な並べ替え結果と期待するロジックをスクリーンショットを添えてフィードバックしてください。

## 関連ドキュメント

- [自動チェックインとチェックイン監視](./auto-checkin.md)
- [自動更新とリアルタイムデータ](./auto-refresh.md)