# Octopus 渠道管理

> 🧪 该功能目前处于 Beta 阶段，支持在插件内直接管理 Octopus 站点的渠道。

## 功能概述

- 📋 **渠道总览与过滤**：一眼查看所有渠道的名称、类型、模型数量与状态，支持关键字搜索与状态过滤。
- ✏️ **快速创建 / 编辑**：弹出式表单适配 Octopus 字段定义，可配置模型列表与状态。
- 🔄 **模型同步**：支持从上游自动拉取最新模型列表。
- 🗑️ **安全删除**：批量勾选后触发删除前会再次确认，避免误删生产渠道。
- 📦 **密钥导入**：从账号管理中直接导入 API Key 到 Octopus 渠道。

## 与 New API 的差异

Octopus 与 New API 在架构上有一些关键差异：

| 对比项 | New API | Octopus |
|--------|---------|---------|
| 认证方式 | Admin Token + User ID | 用户名 + 密码（JWT） |
| 渠道类型 | 55+ 种类型 | 6 种类型 |
| 分组概念 | 用户分组 | 外部模型 ID（不同概念） |
| 优先级/权重 | 支持 | 不支持 |

因此，在 Octopus 模式下：
- **隐藏分组字段**：Octopus 的"分组"是外部模型 ID，与 New API 完全不同
- **隐藏优先级/权重**：Octopus 不支持这些概念
- **渠道类型选项**：仅显示 6 种 Octopus 支持的类型

## 前置要求

| 配置项 | 说明 |
|--------|------|
| **Octopus 基础 URL** | Octopus 站点地址，例如 `https://octopus.example.com` |
| **用户名** | Octopus 登录用户名 |
| **密码** | Octopus 登录密码 |

> 在插件中打开 **设置 → 基础设置 → Octopus 站点配置**，填写以上信息并保存。系统会自动处理登录和 JWT Token 管理。

## 如何进入功能页面

1. 打开扩展弹窗，点击左侧的 **"设置"**。
2. 在 **基础设置 → 自建站点管理** 中选择 **"Octopus"**。
3. 填写 Octopus 站点配置后，点击 **"验证配置"** 确保连接正常。
4. 在设置页面选择 **"自建站点渠道管理"**，将自动加载远端渠道列表。

## 渠道列表视图

- **搜索框**：支持以名称 / Base URL 关键字模糊搜索。
- **状态筛选**：可快速查看启用或禁用的渠道。
- **自定义列**：通过列选择器控制显示的列（分组列在 Octopus 模式下默认隐藏）。
- **批量操作栏**：在行前打勾即可开启批量删除或批量同步。

## 创建或编辑渠道

1. 点击右上角 **"新增渠道"** 或在行尾菜单选择 **"编辑"**。
2. 在弹窗中填写：
   - **基础信息**：名称、类型、API Key、Base URL。
   - **模型列表**：支持全选、反选、清空，并可手动输入自定义模型。
   - **状态**：启用/停用。
3. 点击 **"保存"** 后，系统会调用 Octopus 的渠道接口，成功后自动刷新列表。

### Octopus 渠道类型

| 类型值 | 名称 | 说明 |
|--------|------|------|
| 0 | OpenAI Chat | OpenAI 聊天补全 API |
| 1 | OpenAI Response | OpenAI 响应模式 |
| 2 | Anthropic | Claude API |
| 3 | Gemini | Google Gemini API |
| 4 | Volcengine | 火山引擎 API |
| 5 | OpenAI Embedding | OpenAI 嵌入 API |

## 从密钥管理导入

1. 在 **密钥管理** 页面选择一个账号的 API Key。
2. 点击 **"导入到 Octopus"** 按钮。
3. 系统会自动：
   - 获取上游可用模型列表
   - 构建渠道名称（格式：`站点名 | 密钥名 (auto)`）
   - 添加 `/v1` 后缀到 Base URL（Octopus 规则）
   - 默认启用自动同步功能
4. 导入成功后可在渠道管理页面查看。

## 模型同步

Octopus 模型同步会调用 Octopus 的 `/api/v1/channel/fetch-model` 接口，从上游自动拉取最新模型列表。

1. 在渠道列表中点击行尾的 **"同步"** 按钮触发单渠道同步。
2. 或勾选多个渠道后点击 **"批量同步"** 进行批量操作。
3. 也可以在 **模型同步** 页面进行全局同步操作。

## 常见问题

| 问题 | 解决方案 |
|------|----------|
| 渠道列表为空 | 检查 Octopus 配置是否填写完整，点击"验证配置"确认连接正常。 |
| 登录失败 | 确保用户名和密码正确，Octopus 站点可访问。 |
| 导入时报错 | 检查源账号是否有有效的 API Key，上游站点是否可访问。 |
| 类型显示 Unknown | 可能是 Octopus 返回了未知的类型值，请检查渠道配置。 |

## 关联文档

- [New API 渠道管理](./new-api-channel-management.md)：New API 站点的渠道管理。
- [New API 模型列表同步](./new-api-model-sync.md)：自动批量同步渠道模型。
- [快速导出与集成](./get-started.md#quick-export-sites)：了解如何把渠道推送到下游应用。
