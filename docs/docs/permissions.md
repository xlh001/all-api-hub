# 权限管理（可选权限）

> 只有在需要临时窗口过盾、自动刷新或后台补充 Cookie/请求头时，才需要授予这些可选权限；日常使用时可以保持全部关闭。

## 功能概览

- **集中管理可选权限**
  - 在“权限管理”页面统一查看、授予或撤销扩展的可选权限状态。
- **与 Cloudflare 过盾集成**
  - 部分权限用于支持临时窗口过盾（如 Cloudflare 5 秒盾），确保在站点存在防火墙时仍能正常刷新数据。
- **随时可撤销**
  - 所有可选权限都可以在浏览器设置或插件“权限管理”页中随时关闭，不影响核心离线功能。

## 设置入口

1. 打开插件 → 进入 **设置** 页面。
2. 当浏览器支持可选权限时，会出现 **“权限管理 / Permissions”** 标签页。
3. 点击进入即可看到当前扩展可用的可选权限列表及状态。

> 提示：如果你的浏览器不支持或未启用相关权限，这个标签页可能不会出现。

## 支持的权限类型

具体权限名称可能因浏览器而略有差异，但通常包括：

- **Cookies（Cookie 权限）**
  - 作用：允许扩展在受控范围内读取必要的 Cookie，以便在后台请求中附加认证信息。
  - 典型场景：
    - 临时窗口过盾完成后，将同一会话 Cookie 带到后台刷新请求中。

- **Web Request（网络请求观察）**
  - 作用：允许扩展在特定场景下观察即将发送的请求（例如为过盾流程补充必要请求头）。
  - 典型场景：
    - 判断请求是否被防火墙拦截、是否需要触发临时窗口重试。

- **Web Request Blocking（网络请求阻断/修改）**
  - 作用：在请求发出前同步修改请求（如附加 Cookie、Header），保证在防火墙/Cloudflare 前正确携带认证信息。
  - 典型场景：
    - 确保 Cloudflare 过盾或带 Cookie 的刷新请求能稳定通过站点防护。

> 扩展不会利用这些权限扫描与你无关的站点，仅在你已连接的中转站域名上、且在必要工作流中使用。

## 状态与操作

在权限管理页面中，你可以看到：

- **状态标记**
  - “检测中 / Checking…”：正在与浏览器同步权限状态。
  - “已授予 / Granted”：当前已被浏览器允许。
  - “未授予 / Not granted”：当前未被允许。
- **操作按钮**
  - **允许（推荐）**：向浏览器发起权限请求弹窗。
  - **撤销**：主动收回当前权限。
  - **刷新状态**：当你在浏览器设置中手动修改过权限后，可点击刷新同步状态。

## 何时需要打开这些权限？

- 建议在以下场景再考虑开启：
  - 频繁访问带有 Cloudflare 或其它防火墙保护的中转站，希望自动完成过盾并刷新数据。
  - 需要在后台自动刷新大量账号数据，并希望尽量减少因防护导致的失败。
- 在以下场景下，可以保持关闭：
  - 仅偶尔手动刷新少量账号。
  - 使用的中转站无额外防火墙或 5 秒盾等保护。

## 隐私与安全说明

- 插件默认 **完全离线运行**，所有账号与站点配置存储在浏览器本地。
- 可选权限仅在以下情况下启用：
  - 你在权限管理页显式点击“允许”；
  - 浏览器弹出权限请求对话框并由你确认。
- 你可以随时：
  - 在“权限管理”页点击“撤销”；
  - 或在浏览器自身的扩展管理界面中移除相关权限。

## 故障排查

- **点击“允许”后没有任何反应？**
  - 可能是浏览器未弹出权限对话框，或被系统拦截；
  - 检查地址栏附近是否有权限图标或提示。
- **过盾/刷新仍然失败？**
  - 确认 Cloudflare 过盾相关设置已开启，并参考 [Cloudflare 过盾助手](./cloudflare-helper.md) 文档；
  - 检查你的网络环境（代理、防火墙、IP 质量等）。

## 相关文档

- [Cloudflare 过盾助手](./cloudflare-helper.md)
- [自动刷新与实时数据](./auto-refresh.md)
- [WebDAV 备份与自动同步](./webdav-sync.md)
