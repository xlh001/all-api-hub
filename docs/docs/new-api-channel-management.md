# New API 渠道管理

> 🧪 该功能目前处于 Beta 阶段，旨在把最常用的渠道运营动作（建站、调参、同步）浓缩进插件内，不必频繁往返 New API 后台。

## 功能概述

- 📋 **渠道总览与过滤**：一眼查看所有渠道的名称、类型、分组、优先级、权重与状态，支持关键字搜索与多标签过滤。
- ✏️ **快速创建 / 编辑**：弹出式表单沿用 New API 字段定义，可一次性配置模型列表、分组、优先级、权重以及状态。
- 🔄 **单通道同步**：调试模型同步时，可直接在列表内对指定渠道触发“同步此渠道”，与批量同步互补。
- 🗑️ **安全删除**：批量勾选后触发删除前会再次确认，避免误删生产渠道。
- 📦 **无缝导出**：与密钥管理联动，创建后可立刻导出到 CherryStudio、New API 或 CC Switch。

## 前置要求

| 配置项 | 说明 |
|--------|------|
| **New API 基础 URL** | 需可访问的后台地址，例如 `https://example.com` |
| **管理员令牌** | 拥有渠道读写权限的 Admin Token |
| **管理员用户 ID** | 与令牌对应的用户 ID |

> 在插件中打开 **设置 → 基础设置 → New API 集成设置**，填写以上信息并保存。配置缺失时渠道管理页面会显示“配置缺失”提示。

## 如何进入功能页面

1. 打开扩展弹窗，点击左侧的 **“设置”**。
2. 在设置页面顶部标题下方选择 **“New API 渠道管理（Beta）”**，或直接点击基础设置里的 **“管理渠道”** 按钮。
3. 若配置无误，将自动加载远端渠道列表。

## 渠道列表视图

- ![New API 渠道管理界面](./static/image/new-api-channel-manage.png)

- **搜索框**：支持以名称 / Base URL / 分组关键字模糊搜索。
- **状态筛选**：右上角的 `状态` 过滤器可快速查看启用、手动暂停或自动禁用的渠道。
- **自定义列**：通过列选择器控制是否显示 Base URL、分组、优先级等列。
- **批量操作栏**：在行前打勾即可开启批量删除。

## 创建或编辑渠道

1. 点击右上角 **“新增渠道”** 或在行尾菜单选择 **“编辑”**。
2. 在弹窗中填写：
   - **基础信息**：名称、类型、API Key、Base URL。
   - **模型列表**：支持全选、反选、清空，并可手动输入自定义模型。
   - **用户分组**：自动读取 New API 后台的分组，也可自定义。
   - **高级设置**：优先级（priority）、权重（weight）、状态（启用/停用）。
3. 点击 **“保存”** 后，系统会调用 New API 的 `POST/PUT /api/channel` 接口，成功后自动刷新列表。

### 字段校验

- 渠道名称与 API Key 为必填（编辑时可根据需求放宽）。
- 部分类型（如火山、Suno）要求提供 Base URL。
- 未通过验证的字段会提示原因；提交失败会在右上角弹出 toast。

## 单通道同步

若你正在配合 **New API 模型同步** 调试，可在列表中点击行尾的 **“同步”** 按钮，仅对当前渠道触发模型重定向生成与重试，便于快速验证。

## 删除渠道

1. 勾选要删除的渠道，点击 **“删除”**。
2. 弹窗中确认后才会调用 `DELETE /api/channel/{id}`。
3. 若返回错误（如权限不足），界面会展示后端返回的详细信息。

## 高阶技巧

- **配合模型白名单**：先在模型同步页设定白名单，再返回渠道页单独同步，可确保新渠道仅包含需要的模型。
- **[优先级与权重](https://docs.newapi.pro/zh/docs/support/faq#-%E6%B8%A0%E9%81%93%E9%85%8D%E7%BD%AE%E9%97%AE%E9%A2%98)**：
  - 优先级（`Priority`）：数字越大优先级越高，优先级高的渠道会优先被使用
  - 权重（`Weight`）：在同优先级的渠道中，按权重比例分配请求
- **批量导出**：保存渠道后，可在 **密钥管理 → 导出** 面板一键推送到 CherryStudio / CC Switch，避免重复输入。

## 常见问题

| 问题 | 解决方案 |
|------|----------|
| 渠道列表为空 | 检查 New API 配置是否填写完整或网络是否可访问后台。 |
| 保存时报 401/403 | 确保管理员令牌拥有渠道写权限，必要时重新生成 Token。 |
| 模型/分组列表为空 | 插件仍会允许手动输入；可在 `设置 → New API 集成` 中重新保存配置后再试。 |
| 点击同步无响应 | 请检查浏览器是否禁用后台脚本，或在模型同步页确认全局同步功能可正常运行。 |

## 关联文档

- [New API 模型列表同步](./new-api-model-sync.md)：自动批量同步渠道模型。
- [快速导出与集成](./get-started.md#quick-export-sites)：了解如何把渠道推送到下游应用。
